if(!FE.sys.Alibar){jQuery.namespace("FE.sys.Alibar");(function(e,j,g){var r,d,m=false,f=e.util,k=e.noop,a=FE.util,h=e.util.ua.ie6;var o={urlInit:function(){e("li.account-signout>a",r).attr("href",(n("style.loginchinahttp.url")||"http://login.1688.com")+"/member/signout.htm");e("li.account-signin>a",r).attr("href",(n("style.loginchina.url")||"https://login.1688.com")+"/member/signin.htm?Done="+encodeURIComponent(location.href))},loginfoInit:function(){function s(){var u=e("span.account-id",r),y="http://me.1688.com/",v;e("li.account-msg, li.account-signin, li.account-signup, li.account-signout",r).addClass("fd-hide");t();A({source:["b2b","taobao"]}).always(function(){if(a.IsLogin()){e("li.account-msg, li.account-signout",r).removeClass("fd-hide");v=e("<a>",{href:y,html:z(a.LoginId()),target:"_blank",title:a.LoginId()});if(e("li.vipInfoBox",r).length){v.addClass("nav-arrow")}u.html(v);window.aliclick&&v.mousedown(w);x();e.ajax("http://work.1688.com/home/unReadMsgCount.htm",{dataType:"jsonp",success:function(F){var E=e("li.account-msg",r),C=E.children(),D;C.children().remove();if(F.success&&F.count>0){D=e("<span>",{html:F.count>99?"99+":F.count});C.append(D);C.attr("title","\u4f60\u6709\u65b0\u6d88\u606f");window.aliclick&&D.mousedown(function(){aliclick(this,"?tracelog=cn_alibar_msg")})}else{C.attr("title","\u67e5\u770b\u4f60\u7684\u6d88\u606f")}}})}else{e("li.account-signin, li.account-signup",r).removeClass("fd-hide");if(a.LastLoginId()){v=e("<a>",{href:y,html:z(a.LastLoginId()),target:"_blank",title:a.LastLoginId()}).mousedown(w);u.html(v);window.aliclick&&v.mousedown(w)}else{u.html("\u6b22\u8fce\u6765\u5230\u963f\u91cc\u5df4\u5df4");e("li.account-msg span",r).remove()}}});function z(C){var D="";if(C.length<=11){return C}else{if(escape(C).indexOf("%u")!==-1){D=C.substring(0,10)+"..."}else{D=C.length>14?C.substring(0,13)+"...":C}return D}}function x(){e.use("util-cookie",function(){var E=e.util.cookie("__rn_refer_login_id__");var C=a.getLastMemberId();var D=e.util.cookie("__cn_logon_id__");var F=e.util.cookie("__rn_alert__");if(!E||E!==D){e.ajax("http://member.1688.com/member/rename/rename_cookie_sync.do?memberId="+C,{dataType:"jsonp",success:function(G){if(G.success){F=e.util.cookie("__rn_alert__");if(F&&F==="true"){B()}else{l();i()}}else{l();i()}},error:function(){}})}else{if(F&&F==="true"){B()}}})}function A(D){if("updateLoginInfo" in a){return a.updateLoginInfo(D)}else{var C=new e.Deferred;C.resolve();return C}}function w(){aliclick(this,"?tracelog=cn_alibar_id")}function B(){var C="http://member.1688.com/member/prename/pre_name.htm?req_from=alibar";var D=('<div class="tips-content"><div class="tip-text add"><div class="modify_nick_btn"><a href="'+C+'">\u8bf7\u7acb\u5373\u4fee\u6539\u7528\u6237\u540d</a></div></div><div class="tips-close"></div></div><div class="tips-top"></div>');d.html(D);q(false)}function t(){e("a.modify-nick",r).remove()}}s();j.refresh=s},dropdownInit:function(){e("li.extra",r).mouseenter(function(){h&&e(this).addClass("nav-hover");e(this).prev().addClass("nav-hover-prev")}).mouseleave(function(){h&&e(this).removeClass("nav-hover");e(this).prev().removeClass("nav-hover-prev")})},vipInfoInit:function(){var w=e("li.vipInfoBox",r);var A=null;var s=null;var x='<p class="reLoginRemind">\u60a8\u7684\u767b\u5f55\u72b6\u6001\u5df2\u5931\u6548,<a href="http://login.1688.com/member/signin.htm" target="_self">\u8bf7\u91cd\u65b0\u767b\u5f55</a></p>';var y='<p class="subAccountRemind">\u60a8\u597d\uff01\u60a8\u5f53\u524d\u767b\u9646\u4e86\u4f1a\u5458\u5b50\u8d26\u53f7  <a href="http://login.1688.com/member/signout.htm" target="_self">\u9000\u51fa</a></p>';if(!w.length){return}var u=0;w.mouseenter(function(){A=e(this);if(!a.IsLogin()||u){return}b();t();e.ajax({url:"http://vip.1688.com/club/club_info_json.do",dataType:"jsonp",success:function(C){if(C.success!==true){if(C.data.errorMsg==="NOT_LOGIN"){B();e("li.vipInfoBox div.nav-content",r).html(x);u=1}else{if(C.data.errorMsg==="SUB_ACCOUNT"){B();e("li.vipInfoBox div.nav-content",r).html(y);u=1}}return}z(C.data);B();u=1},error:function(){}})});if(a.IsLogin()){w.hover(function(){e(".modify_nick",r).addClass("fd-hide");if(s){clearTimeout(s);s=null}setTimeout(function(){A.addClass("infoHover")},100)},function(){s=setTimeout(function(){A.removeClass("infoHover");s=null},400)})}function z(F){var C=a.getLastMemberId();C=C?C:"";var D='<div class="levelWrapper fd-clr">                                    <div class="memberPhoto">                                        <a href="http://me.1688.com" target="_blank">                                            <img src="<%= this.userImg %>" alt="" onerror="<%= this.error %>"/>                                        </a>                                    </div>                                    <div class="level">                                        <p class="account">                                            <a class="accountManage" href="http://work.1688.com/home/page/index.htm#app=accountmanagement&menu=&channel=" target="_blank">\u8d26\u53f7\u7ba1\u7406</a>                                            <span class="sep">|</span>                                            <a class="signout" href="http://login.1688.com/member/signout.htm" data-trace="cn_alibar_quit" title="\u9000\u51fa">\u9000\u51fa</a>                                        </p>                                        <p class="supplyLevel fd-clr">                                            <% if( typeof $data.saleRate !== "undefined" ) { %>                                                <span class="title">\u4f9b\u5e94\u7b49\u7ea7:</span>                                                <a class="levelImg" data-trace="alibar_supplier_rank" href="<%= $data.saleRate.targetUrl %>" target="_blank" title="<%= $data.saleRate.tips %>">                                                    <img src="<%= $data.saleRate.logoUrl %>" alt=""/>                                                </a>                                            <% } else if(typeof $data.saleRate === "undefined" && typeof $data.buyRate === "undefined" && $data.medals.length === 0 ) { %>                                                <a class="vipClub" data-trace="alibar_vip_club" href="http://vip.1688.com" target="_blank">\u53bb\u4f1a\u5458\u4ff1\u4e50\u90e8\u901b\u901b</a>                                            <% } %>                                        </p>                                        <p class="purchaseLevel fd-clr">                                            <% if( typeof $data.buyRate !== "undefined" ) { %>                                                <span class="title">\u91c7\u8d2d\u7b49\u7ea7:</span>                                                <a class="levelImg" data-trace="alibar_buyers_rank" href="<%= $data.buyRate.targetUrl %>" target="_blank" title="<%= $data.buyRate.tips %>">                                                    <img src="<%= $data.buyRate.logoUrl %>" alt=""/>                                                </a>                                            <% } else if(typeof $data.saleRate === "undefined" && typeof $data.buyRate === "undefined" && $data.medals.length === 0 ) { %>                                                <a class="newComer" data-trace="alibar_vip_noviciate" href="http://page.1688.com/html/service/aliguide/seller_user_guide.html" target="_blank">\u65b0\u624b\u5e2e\u52a9\u4e2d\u5fc3</a>                                            <% } %>                                        </p>                                    </div>                                </div>                                <% if( $data.medals.length ) { %>                                    <div class="medalWrapper fd-clr">                                        <% for ( var i = 0; i < $data.medals.length; i++ ) { %>                                            <a class="medal" href="<%= $data.medals[i].targetUrl %>" data-trace="alibar_medal_rank" title="<%= $data.medals[i].tips %>">                                                <img src="<%= $data.medals[i].logoUrl %>" alt=""/>                                            </a>                                        <% } %>                                    </div>                                <% } %>';var E=v(C);var G={userImg:E,error:"this.src='http://img.china.alibaba.com/cms/upload/2012/137/253/352731_936034060.png';this.onerror=null;"};e.use("web-sweet",function(){var H;var I=e("li.vipInfoBox div.nav-content",r);H=FE.util.sweet(D).applyData(F,G);I.html(H)})}function v(H){var G=H.substring(0,1),E=H.substring(1,2),D=H.substring(2,3),F=H.substring(3,4);var C=G+"/"+E+"/"+D+"/"+F+"/";return"http://img.china.alibaba.com/club/upload/pic/user/"+C+H+"_s.jpeg"}function t(){var C=e("div.nav-content",w);C.addClass("alibar-loading");C.css("height",60)}function B(){var C=e("div.nav-content",w);C.removeClass("alibar-loading");C.css("height","auto")}},purchaselistInit:function(){var y=e("li.topnav-purchaselist",r);if(!y.length){return}var z=e("div.nav-title",y),t=e("em",z),v=e("div.nav-content",y),x=v.children(".product-list"),w=v.children(".purchase-info"),u=e("p",x);y.mouseenter(function(){window.aliclick&&aliclick(this,"?tracelog=cn_alibar_purchaselist_hover");F()});x.on("click","a.delete",function(J){J.preventDefault();var H=e(this).closest("dl"),I=H.data("item"),G="offer";e.ajax({url:(n("style.luna.url")||"http://order.1688.com")+"/order/purchase/ajax/delete_from_purchase_list_no_csrf_auth.jsx",dataType:"script",cache:false,data:{returnType:"jsonp",batchDel:[G,I.goodsID,I.specId].join()},success:function(){if(window.delFromPurchaseListResult&&delFromPurchaseListResult.success){m=false;F();e(document).triggerHandler("delitem.alibar");window.delFromPurchaseListResult=g}},error:function(){m=false;F()}})});function F(){if(m){return}s();e.ajax({url:(n("style.luna.url")||"http://order.1688.com")+"/order/purchase/ajax/quick_purchase_list.jsx",dataType:"jsonp",success:function(H){if(H.success!==true){return}E();x.children("h3, dl").remove();w.children("p").remove();var G=H.totalKind||H.sumOfKind;t.text(G);B(G);if(G){C(H.data);D(H)}if(H.totalKind&&x.find("dl").length){x.prepend("<h3>\u6700\u8fd1\u52a0\u5165\u7684\u8d27\u54c1\uff1a</h3>")}m=true},error:function(){E()}})}function A(){e.ajax({url:(n("style.luna.url")||"http://order.1688.com")+"/order/purchase/ajax/quick_purchase_list_count.jsx",dataType:"jsonp",success:function(H){if(H.success!==true){return}var G=H.sumOfKind;t.text(G);B(G);m=false}})}function B(G){if(G){y.addClass("topnav-purchaselist-stock")}else{y.removeClass("topnav-purchaselist-stock")}}function C(G){e.each(G,function(K,M){if(K>4){return false}var I=e("<dl>"),L=f.escapeHTML(M.goodsName,true),J=["<dt>",'<a title="',L,'" target="_blank" href="',M.imgLinkUrl,'" data-trace="cn_alibar_purchaselist_offerdetail"></a>',"</dt>",'<dd class="title">','<a title="',L,'" target="_blank" href="',M.imgLinkUrl,'" data-trace="cn_alibar_purchaselist_offerdetail">',f.escapeHTML(M.goodsName.cut(23,"...")),"</a>","</dd>",'<dd class="price">',"&yen;<em>",M.goodsPrice,"</em>\u5143&nbsp;\u00d7&nbsp;<span>",M.goodsCount,"</span>","</dd>",'<dd class="action"><a class="delete" title="\u5220\u9664" href="#">\u5220\u9664</a></dd>'],H=new Image();e(H).one("load",function(){if(this.width&&this.height){var N,P;P=N=50;if(this.width>N||this.height>P){var Q=this.width/this.height,O=Q>=N/P;H[O?"width":"height"]=O?N:P;if(h){H[O?"height":"width"]=(O?N:P)*(O?1/Q:Q)}}}});H.alt=M.goodsName;H.src=M.imgUrl;I.html(J.join("")).data("item",M);x.append(I.html(J.join("")).data("item",M));e(">dt>a",I).append(H)})}function D(I){var H=e("<p>"),G=[];if(I.remainKind){G=['\u8fdb\u8d27\u5355\u8fd8\u5269\u4f59\u8d27\u54c1\uff1a<span class="orange">',I.remainKind,"</span>\u79cd\uff08",I.remainCount,"\u4ef6\uff09"]}else{if(I.sumOfKind){G=["\u5171\u8ba1<span>",I.sumOfKind,"</span>\u79cd\u8d27\u54c1\uff08",I.sumOfAcount,"\u4ef6\uff09<br/>\u8d27\u54c1\u5408\u8ba1\uff1a<em>",I.sumOfPrice.toFixed(2),"</em>\u5143"]}}w.prepend(H.html(G.join("")))}function s(){x.addClass("alibar-loading");var G=0;if(x.children("dl").length){G=x.height()}else{G=60}x.css("height",G);u.addClass("fd-hide")}function E(){x.removeClass("alibar-loading");x.css("height","auto");u.removeClass("fd-hide")}A();j.purchaselistRefresh=A},tpInit:function(){e("li.topnav-tp",r).one("mouseenter",function(){var s=this;e.use("web-alitalk-shunt",function(){FE.util.alitalk.shunt(e("a.order-online",s),{attr:"alitalk-shunt",ruleId:"ALITALK_INCALL_ROLE_CTP01"})})})},traceInit:function(){window.aliclick&&e("#alibar-v4").on("mousedown","a[data-trace]",function(){aliclick(this,"?tracelog="+e(this).data("trace"))})},sessionKeeper:function(){e(window).one("load",function(){e.getScript("http://style.c.aliimg.com/sys/js/session-keeper/session-keeper.js")})}};function l(){var s="show_inter_tips";if(p()){return}if(e.util.subCookie(s)!="false"){q(true);e.use("util-cookie",function(){e(".tips-close",d).on("click",function(){e.util.subCookie(s,"false")})})}}function i(){if(p()){return}e(window).on("userSwitchedToTB",function(s,t){e(".tip-text",d).html(e.util.substitute('<p>\u60a8\u6b63\u5728\u4f7f\u7528 <em>\u6dd8\u5b9d\u5e10\u53f7 {nick}</em> \u8bbf\u95ee\u963f\u91cc\u5df4\u5df4\u4e2d\u56fd\u7ad9\uff0c\u60a8\u53ef\u4ee5\u201c<a href="http://login.1688.com/member/logout.htm">\u9000\u51fa</a>\u201d\u540e\u91cd\u65b0\u767b\u5f55\u5176\u4ed6\u963f\u91cc\u5df4\u5df4\u5e10\u53f7\u3002\u7f51\u5e97\u8fdb\u8d27\u53ef\u4ee5\u6765\u201c<a href="http://tao.1688.com/?tracelog=hipage_home_alibar" target="_blank">\u6dd8\u8d27\u6e90</a>\u201d\u901b\u901b\u54e6~<a class="i-know" href="#i-know">\u6211\u77e5\u9053\u4e86</a></p>',t));q(true)});d.on("click","a.i-know",function(s){s.preventDefault();b()});e(window).one("load",function(){e.getScript("http://style.c.aliimg.com/sys/js/common/user-switching-notify.js")})}function n(s){return FE.test&&FE.test[s]}function p(){var s=/d.1688.com|d.1688.com/g;if(s.test(document.location.host)){return true}return false}function q(s,t){if(t){e(".tip-text",d).html(t)}d.show().offset(c());if(s){d.delay(10000).fadeOut(100)}e(".tips-close",d).on("click",function(u){u.preventDefault();b()});e(window).resize(function(){setTimeout(function(){d.offset(c())},25)})}function c(){var t=e(".account-id",r).offset();var s=r;return{left:t.left-5,top:s.offset().top+s.height()}}function b(){d.hide()}j.refresh=j.refresh||k;j.purchaselistRefresh=j.purchaselistRefresh||k;j.showTip=q;j.hideTip=b;e(function(){r=r||e("#alibar-v4");d=e(".alibar-tips",r);if(r.length){for(var s in o){o[s]()}}})})(jQuery,FE.sys.Alibar)};
